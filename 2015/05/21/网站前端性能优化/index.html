<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>网站前端性能优化指南 | 凯歌的博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="2014年末，我为平安官网门户首页做了一次大的性能优化，性能做8秒多提速到5秒多，性能提升比较明显。网站前端性能的提升，给企业带来的价值是服务器带宽和并发请求的节省，从而节省开支。另外公司也一直在鼓励提升NPM，即用户口碑和用户体验，网站性能对用户体验是最直接的影响，因为谁也不想超过8秒都打不开一个网站吧。
说到性能优化，我想大家一定会联想到“雅虎前端性能优化N条军规”，这个文章以前在前端界很火，">
<meta property="og:type" content="article">
<meta property="og:title" content="网站前端性能优化指南">
<meta property="og:url" content="http://blog.css6.com/2015/05/21/网站前端性能优化/index.html">
<meta property="og:site_name" content="凯歌的博客">
<meta property="og:description" content="2014年末，我为平安官网门户首页做了一次大的性能优化，性能做8秒多提速到5秒多，性能提升比较明显。网站前端性能的提升，给企业带来的价值是服务器带宽和并发请求的节省，从而节省开支。另外公司也一直在鼓励提升NPM，即用户口碑和用户体验，网站性能对用户体验是最直接的影响，因为谁也不想超过8秒都打不开一个网站吧。
说到性能优化，我想大家一定会联想到“雅虎前端性能优化N条军规”，这个文章以前在前端界很火，">
<meta property="og:updated_time" content="2015-10-10T07:14:14.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="网站前端性能优化指南">
<meta name="twitter:description" content="2014年末，我为平安官网门户首页做了一次大的性能优化，性能做8秒多提速到5秒多，性能提升比较明显。网站前端性能的提升，给企业带来的价值是服务器带宽和并发请求的节省，从而节省开支。另外公司也一直在鼓励提升NPM，即用户口碑和用户体验，网站性能对用户体验是最直接的影响，因为谁也不想超过8秒都打不开一个网站吧。
说到性能优化，我想大家一定会联想到“雅虎前端性能优化N条军规”，这个文章以前在前端界很火，">
  
  
  <link rel="icon" href="/favicon.png">
  
  <link href="http://cdn.css6.com/css/style.css" rel="stylesheet" type="text/css">
  
    <link href="http://cdn.css6.com/fancybox/jquery.fancybox.css" rel="stylesheet" type="text/css">
  
  
     <link href="http://cdn.css6.com/scrollLoading/style.css" rel="stylesheet" type="text/css">
  
  

  
    <link href='//fonts.useso.com/css?family=Titillium+Web:300,400,600' rel='stylesheet' type='text/css'>
    <link href="//fonts.useso.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link href="//cdn.bootcss.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet">
</head>

<body>
  <div id="wrap">
    <header id="header">
  <div id="header-outer" class="outer">
    <div class="container">
      <div class="container-inner">
        <div id="header-title">
          <h1 class="logo-wrap">
            <a href="/" class="logo"><img src="http://cdn.css6.com/css/images/logo-header.png" width="165" height="60" alt="凯歌的博客" /></a>
          </h1>
          
        </div>
        <div id="header-inner" class="nav-container">
          <a id="main-nav-toggle" class="nav-icon fa fa-bars"></a>
          <div class="nav-container-inner">
            <ul id="main-nav">
              
                <li class="main-nav-list-item" ><a class="main-nav-list-link" href="/">主页</a></li>
              
                    <ul class="main-nav-list"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/前端笔记/">前端笔记</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/吐槽/">吐槽</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/技术文摘/">技术文摘</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/生活随笔/">生活随笔</a></li></ul>
                  
                <li class="main-nav-list-item" ><a class="main-nav-list-link" href="/2014/11/25/about-me/">关于</a></li>
              
            </ul>
            <nav id="sub-nav">
              <div id="search-form-wrap">
                <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="搜索"><input type="hidden" name="sitesearch" value="http://blog.css6.com"></form>
              </div>
            </nav>
          </div>
        </div>
      </div>
    </div>
  </div>
</header>
    <div class="container">
      <div class="main-body container-inner">
        <div class="main-body-inner">
          <section id="main">
            <div class="main-body-header">

              <h1 class="header"><a class="page-title-link" href="/categories/前端笔记/">前端笔记</a></h1>
            </div>
            <div class="main-body-content">
              
  <article id="post-网站前端性能优化" class="article article-single article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
      <!--  -->
      
        <header class="article-header">
          
  
    <h1 class="article-title" itemprop="name">
      网站前端性能优化指南
    </h1>
  

        </header>
      
      <p class="article-byline">
        <a href="/2015/05/21/网站前端性能优化/" class="article-date">
  <time datetime="2015-05-21T08:11:20.000Z" itemprop="datePublished">2015-05-21</time>
</a>
      </p>
      <div class="article-entry" itemprop="articleBody">
        <p>2014年末，我为平安官网门户首页做了一次大的性能优化，性能做8秒多提速到5秒多，性能提升比较明显。网站前端性能的提升，给企业带来的价值是服务器带宽和并发请求的节省，从而节省开支。另外公司也一直在鼓励提升NPM，即用户口碑和用户体验，网站性能对用户体验是最直接的影响，因为谁也不想超过8秒都打不开一个网站吧。</p>
<p>说到性能优化，我想大家一定会联想到“雅虎前端性能优化N条军规”，这个文章以前在前端界很火，导致很多工程师觉得遵守雅虎工程师提到的那些条性能优化的准则就够了。其实是远远不够的，性能优化没有终点。</p>
<p>下面，结合互联网和书本的一些资料，以及我个人的经验，我们来谈谈怎样进行深度的性能优化。</p>
<h2 id="1、减少HTTP请求数">1、减少HTTP请求数</h2><p>什么是HTTP请求呢？简单的说是服务器端返回给客户端的请求文件，如html、JS、CSS、图片、ajax数据 等等……</p>
<h3 id="合并JS文件">合并JS文件</h3><p>把JS文件按需合并，除JS框架外，一个页面尽量只引用一个JS文件。可以借助require.js、seaJS等 JS模块化框架，管理好JS的加载和依赖关系，避免合并后依赖关系混乱从而导致JS错误。</p>
<a id="more"></a>
<h3 id="合并CSS文件">合并CSS文件</h3><p>CSS文件按照架构划分，该作为公共CSS文件的就单独引用，当前页面或页面组的CSS单独引用，一个页面建议不超过2个CSS文件数。</p>
<h3 id="减少图片请求数">减少图片请求数</h3><p>CSS引用的背景图片尽量合并在一张图片里，网上大家把这种方法叫“CSS sprite”，其实方法很简单，即用背景图片的position值的定位，把每个小图片显示到相应的坐标位置。</p>
<p>如果一个页面中只有少量几个小图标，而且对可维护性要求不高，建议可以用内联图片形式，这样可以减少图片请求。</p>
<p>关于什么是内联图片？</p>
<p>例如：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">background:#ececec url(data:image/gif;base64,R0lGdflhBgdfff39/T09PPz8+/v7+3t7ePj49bW1tXV1c/Pz87Ozr29vbGxsbCwsKOjo5CQkI+Pj3Z2dmdnZ2ZmZmVlZWJiYmFhYV1dXVtbWwAAAAAAAAAAAAAAAAAAAAAAACH5BAAHAP8ALAAAAAAGAAYAAAdfdMj5VFBnJVFcYs2TRdTgFhl3QEBkbjAAgBADs=) no-repeat;</span><br></pre></td></tr></table></figure>
<p>以base64位代码的形式嵌入到HTML或CSS文件中。</p>
<p>如果图片过大，base64代码也会很多，这样不利于后期的维护，建议不要大量使用。</p>
<p>###减少ajax请求</p>
<p>根据项目的实际情况，将同类型或同功能的多个ajax请求合并成一个。</p>
<h2 id="2、精简和压缩javascript、CSS、HTML">2、精简和压缩javascript、CSS、HTML</h2><p>精简是指从去除代码不必要的字符减少文件大小从而节省下载时间。消减代码时，所有的注释、不需要的空白字符（空格、换行、tab缩进）等都要去掉。在JavaScript中，由于需要下载的文件体积变小了从而节省了响应时间。精简JavaScript中目前用到的最广泛的两个工具是JSMin和YUI Compressor。YUI Compressor还可用于精简CSS。</p>
<p>混淆是另外一种可用于源代码优化的方法。这种方法要比精简复杂一些并且在混淆的过程更易产生问题。在对美国前10大网站的调查中发现，精简也可以缩小原来代码体积的21%，而混淆可以达到25%。尽管混淆法可以更好地缩减代码，但是对于JavaScript来说精简的风险更小。 </p>
<p>除消减外部的脚本和样式表文件外，<script>和<style>代码块也可以并且应该进行消减。即使你用Gzip压缩过脚本和样式表，精简这些文件仍然可以节省5%以上的空间。由于JavaScript和CSS的功能和体积的增加，消减代码将会获得益处。</p>
<h2 id="3、使用CDN分布式网络存储静态文件">3、使用CDN分布式网络存储静态文件</h2><p>很多大型网站都会用CDN分布式网络，用它来存储CSS、JS、图片 等等静态文件。</p>
<p><strong>它的好处是：</strong></p>
<ul>
<li><p>在全国甚至全球的服务器中智能请求到最近的服务器，使客户端请求速度加快</p>
</li>
<li><p>减少后端服务器的负担，使服务器资源专注于数据的运算和传输</p>
</li>
<li><p>减少cookie的传输。在普通的无CDN网站上，请求当前页面的图片和其他文件之前，会将本站的cookie先发送到服务器。如果用独立域名的CDN网络，会避免或减少让当前域带cookie。</p>
</li>
</ul>
<p>用户与你网站服务器的接近程度会影响响应时间的长短。把你的网站内容分散到多个、处于不同地域位置的服务器上可以加快下载速度。但是首先我们应该做些什么呢？</p>
<p>按地域布置网站内容的第一步并不是要尝试重新架构你的网站让他们在分发服务器上正常运行。根据应用的需求来改变网站结构，这可能会包括一些比较复杂的任务，如在服务器间同步Session状态和合并数据库更新等。要想缩短用户和内容服务器的距离，这些架构步骤可能是不可避免的。 </p>
<p>要记住，在终端用户的响应时间中有80%到90%的响应时间用于下载图像、样式表、脚本、Flash等页面内容。这就是网站性能黄金守则。和重新设计你的应用程序架构这样比较困难的任务相比，首先来分布静态内容会更好一点。这不仅会缩短响应时间，而且对于内容分发网络来说它更容易实现。</p>
<p>内容分发网络（Content Delivery Network，CDN）是由一系列分散到各个不同地理位置上的Web服务器组成的，它提高了网站内容的传输速度。用于向用户传输内容的服务器主要是根据和用户在网络上的靠近程度来指定的。例如，拥有最少网络跳数（network hops）和响应速度最快的服务器会被选定。 </p>
<p>一些大型的网络公司拥有自己的CDN，但是使用像Akamai Technologies，Mirror Image Internet， 或者Limelight Networks这样的CDN服务成本却非常高。对于刚刚起步的企业和个人网站来说，可能没有使用CDN的成本预算，但是随着目标用户群的不断扩大和更加全球化，CDN就是实现快速响应所必需的了。以Yahoo来说，他们转移到CDN上的网站程序静态内容节省了终端用户20%以上的响应时间。使用CDN是一个只需要相对简单地修改代码实现显著改善网站访问速度的方法。</p>
<h2 id="4、对于CDN网络的静态文件使用无coockie域名">4、对于CDN网络的静态文件使用无coockie域名</h2><p>当浏览器在请求中同时请求一张静态的图片和发送coockie时，服务器对于这些coockie不会做任何地使用。因此他们只是因为某些负面因素而创建的网络传输。所有你应该确定对于静态内容的请求是无coockie的请求。创建一个子域名并用他来存放所有静态内容。</p>
<p>如果你的域名是www.example.org，你可以在static.example.org上存在静态内容。但是，如果你不是在www.example.org上而是在顶级域名example.org设置了coockie，那么所有对于static.example.org的请求都包含coockie。在这种情况下，你可以再重新购买一个新的域名来存在静态内容，并且要保持这个域名是无coockie的。Yahoo!使用的是ymig.com，YouTube使用的是ytimg.com，Amazon使用的是images-anazon.com等等。 </p>
<p>使用无coockie域名存在静态内容的另外一个好处就是一些代理（服务器）可能会拒绝对coockie的内容请求进行缓存。一个相关的建议就是，如果你想确定应该使用example.org还是www.example.org作为你的一主页，你要考虑到coockie带来的影响。忽略掉www会使你除了把coockie设置到<em>.example.org（</em>是泛域名解析，代表了所有子域名译者dudo注）外没有其它选择，因此出于性能方面的考虑最好是使用带有www的子域名并且在它上面设置coockie。</p>
<h2 id="5、根据域名划分页面内容">5、根据域名划分页面内容</h2><p>把页面内容划分成若干部分可以使你最大限度地实现平行下载。由于DNS查找带来的影响你首先要确保你使用的域名数量在2个到4个之间。例如，你可以把用到的HTML内容和动态内容放在www.example.<br>org上，而把页面各种组件（图片、脚本、CSS)分别存放在statics1.example.org和statics.example.org上。<br>你可在Tenni Theurer和Patty Chi合写的文章Maximizing Parallel Downloads in the Carpool Lane找到更多相关信息。</p>
<h2 id="6、服务器端设置gzip压缩">6、服务器端设置gzip压缩</h2><p>网络传输中的HTTP请求和应答时间可以通过前端机制得到显著改善。的确，终端用户的带宽、互联网提供者、与对等交换点的靠近程度等都不是网站开发者所能决定的。但是还有其他因素影响着响应时间。通过减小HTTP响应的大小可以节省HTTP响应时间。 </p>
<p>从HTTP/1.1开始，web客户端都默认支持HTTP请求中有Accept-Encoding文件头的压缩格式：</p>
<p>Accept-Encoding: gzip, deflate </p>
<p>如果web服务器在请求的文件头中检测到上面的代码，就会以客户端列出的方式压缩响应内容。Web服务器把压缩方式通过响应文件头中的Content-Encoding来返回给浏览器。 </p>
<p>Content-Encoding: gzip </p>
<p>Gzip是目前最流行也是最有效的压缩方式。这是由GNU项目开发并通过RFC 1952来标准化的。另外仅有的一个压缩格式是deflate，但是它的使用范围有限效果也稍稍逊色。 </p>
<p>Gzip大概可以减少70%的响应规模。目前大约有90%通过浏览器传输的互联网交换支持gzip格式。如果你使用的是Apache，gzip模块配置和你的版本有关：Apache 1.3使用mod_zip，而Apache 2.x使用moflate。 </p>
<p>浏览器和代理都会存在这样的问题：浏览器期望收到的和实际接收到的内容会存在不匹配的现象。幸好，这种特殊情况随着旧式浏览器使用量的减少在减少。Apache模块会通过自动添加适当的Vary响应文件头来避免这种状况的出现。</p>
<p>服务器根据文件类型来选择需要进行gzip压缩的文件，但是这过于限制了可压缩的文件。大多数web服务器会压缩HTML文档。对脚本和样式表进行压缩同样也是值得做的事情，但是很多web服务器都没有这个功能。实际上，压缩任何一个文本类型的响应，包括XML和JSON，都值得的。图像和PDF文件由于已经压缩过了所以不能再进行gzip压缩。如果试图gizp压缩这些文件的话不但会浪费CPU资源还会增加文件的大小。 </p>
<p>Gzip压缩所有可能的文件类型是减少文件体积增加用户体验的简单方法。</p>
<h2 id="7、将CSS文件统一放置在HTML_head_中">7、将CSS文件统一放置在HTML head 中</h2><p>在研究Yahoo!的性能表现时，我们发现把样式表放到文档的<head />内部似乎会加快页面的下载速度。这是因为把样式表放到<head />内会使页面有步骤的加载显示。 </p>
<p>注重性能的前端服务器往往希望页面有秩序地加载。同时，我们也希望浏览器把已经接收到内容尽可能显示出来。这对于拥有较多内容的页面和网速较慢的用户来说特别重要。向用户返回可视化的反馈，比如进程指针，已经有了较好的研究并形成了正式文档。在我们的研究中HTML页面就是进程指针。当浏览器有序地加载文件头、导航栏、顶部的logo等对于等待页面加载的用户来说都可以作为可视化的反馈。这从整体上改善了用户体验。 </p>
<p>把样式表放在文档底部的问题是在包括Internet Explorer在内的很多浏览器中这会中止内容的有序呈现。浏览器中止呈现是为了避免样式改变引起的页面元素重绘。用户不得不面对一个空白页面。</p>
<p>HTML规范清楚指出样式表要放包含在页面的<head />区域内：“和<a />不同，<link />只能出现在文档的<head />区域内，尽管它可以多次使用它”。无论是引起白屏还是出现没有样式化的内容都不值得去尝试。最好的方案就是按照HTML规范在文档<head />内加载你的样式表。</p>
<h2 id="8、将JS文件统一放置在HTML底部（body闭合标签之前）">8、将JS文件统一放置在HTML底部（body闭合标签之前）</h2><p>脚本带来的问题就是它阻止了页面的平行下载。HTTP/1.1 规范建议，浏览器每个主机名的并行下载内容不超过两个。如果你的图片放在多个主机名上，你可以在每个并行下载中同时下载2个以上的文件。但是当下载脚本时，浏览器就不会同时下载其它文件了，即便是主机名不相同。 </p>
<p>在某些情况下把脚本移到页面底部可能不太容易。比如说，如果脚本中使用了document.write来插入页面内容，它就不能被往下移动了。这里可能还会有作用域的问题。很多情况下，都会遇到这方面的问题。</p>
<p>一个经常用到的替代方法就是使用延迟脚本。DEFER属性表明脚本中没有包含document.write，它告诉浏览器继续显示。不幸的是，Firefox并不支持DEFER属性。在Internet Explorer中，脚本可能会被延迟但效果也不会像我们所期望的那样。如果脚本可以被延迟，那么它就可以移到页面的底部。这会让你的页面加载的快一点。</p>
<h2 id="9、避免使用CSS表达式">9、避免使用CSS表达式</h2><p>CSS表达式是动态设置CSS属性的强大（但危险）方法。Internet Explorer从第5个版本开始支持CSS表达式。下面的例子中，使用CSS表达式可以实现隔一个小时切换一次背景颜色：</p>
<p>background-color: expression( (new Date()).getHours()%2 ? “#B8D4FF” : “#F08A00” ); </p>
<p>如上所示，expression中使用了JavaScript表达式。CSS属性根据JavaScript表达式的计算结果来设置。expression方法在其它浏览器中不起作用，因此在跨浏览器的设计中单独针对Internet Explorer设置时会比较有用。 </p>
<p>表达式的问题就在于它的计算频率要比我们想象的多。不仅仅是在页面显示和缩放时，就是在页面滚动、乃至移动鼠标时都会要重新计算一次。给CSS表达式增加一个计数器可以跟踪表达式的计算频率。在页面中随便移动鼠标都可以轻松达到10000次以上的计算量。 </p>
<p>一个减少CSS表达式计算次数的方法就是使用一次性的表达式，它在第一次运行时将结果赋给指定的样式属性，并用这个属性来代替CSS表达式。如果样式属性必须在页面周期内动态地改变，使用事件句柄来代替CSS表达式是一个可行办法。如果必须使用CSS表达式，一定要记住它们要计算成千上万次并且可能会对你页面的性能产生影响。</p>
<h2 id="10、外链CSS和JS文件，不要和HTML混搭">10、外链CSS和JS文件，不要和HTML混搭</h2><p>很多性能规则都是关于如何处理外部文件的。但是，在你采取这些措施前你可能会问到一个更基本的问题：JavaScript和CSS是应该放在外部文件中呢还是把它们放在页面本身之内呢？ </p>
<p>在实际应用中使用外部文件可以提高页面速度，因为JavaScript和CSS文件都能在浏览器中产生缓存。内置在HTML文档中的JavaScript和CSS则会在每次请求中随HTML文档重新下载。这虽然减少了HTTP请求的次数，却增加了HTML文档的大小。从另一方面来说，如果外部文件中的JavaScript和CSS被浏览器缓存，在没有增加HTTP请求次数的同时可以减少HTML文档的大小。 </p>
<p>关键问题是，外部JavaScript和CSS文件缓存的频率和请求HTML文档的次数有关。虽然有一定的难度，但是仍然有一些指标可以一测量它。如果一个会话中用户会浏览你网站中的多个页面，并且这些页面中会重复使用相同的脚本和样式表，缓存外部文件就会带来更大的益处。 </p>
<p>许多网站没有功能建立这些指标。对于这些网站来说，最好的坚决方法就是把JavaScript和CSS作为外部文件引用。比较适合使用内置代码的例外就是网站的主页，如Yahoo!主页和My Yahoo!。主页在一次会话中拥有较少（可能只有一次）的浏览量，你可以发现内置JavaScript和CSS对于终端用户来说会加快响应时间。 </p>
<p>对于拥有较大浏览量的首页来说，有一种技术可以平衡内置代码带来的HTTP请求减少与通过使用外部文件进行缓存带来的好处。其中一个就是在首页中内置JavaScript和CSS，但是在页面下载完成后动态下载外部文件，在子页面中使用到这些文件时，它们已经缓存到浏览器了。</p>
<h2 id="11、避免使用iframe">11、避免使用iframe</h2><p>ifrmae元素可以在父文档中插入一个新的HTML文档。了解iframe的工作理然后才能更加有效地使用它，这一点很重要。</p>
<p><strong>优点</strong></p>
<p>有延迟加载功能，能并发的请求响应。</p>
<p>例如解决加载缓慢的第三方内容如图标和广告等的加载问题 </p>
<p><strong>缺点</strong></p>
<p>即便是个空的html文件在iframe里面，消耗也是相当高的，不利于提高响应速度；</p>
<p>而且它会阻止整个页面的onload的响应； </p>
<p>页面中多一个iframe就是多一个HTTP请求。</p>
<h2 id="12、外链CSS时，用方式代替@import">12、外链CSS时，用<link>方式代替@import</h2><p>前面的最佳实现中提到CSS应该放置在顶端以利于有序加载呈现。</p>
<p>在IE中，页面底部@import和使用<link>作用是一样的，因此最好不要使用它。</p>
<h2 id="13、避免使用使用滤镜">13、避免使用使用滤镜</h2><p>IE独有属性AlphaImageLoader用于修正7.0以下版本中显示PNG图片的半透明效果。这个滤镜的问题在于浏览器加载图片时它会终止内容的呈现并且冻结浏览器。在每一个元素（不仅仅是图片）它都会运算一次，增加了内存开支，因此它的问题是多方面的。</p>
<p>完全避免使用AlphaImageLoader的最好方法就是使用PNG8格式来代替，这种格式能在IE中很好地工作。如果你确实需要使用AlphaImageLoader，请使用下划线_filter又使之对IE7以上版本的用户无效。</p>
<h2 id="14、避免HTTP请求重定向">14、避免HTTP请求重定向</h2><p>跳转是使用301和302代码实现的。下面是一个响应代码为301的HTTP头：</p>
<p>HTTP/1.1 301 Moved Permanently<br>Location: http://example.com/newuri<br>Content-Type: text/html<br>浏览器会把用户指向到Location中指定的URL。头文件中的所有信息在一次跳转中都是必需的，内容部分可以为空。不管他们的名称，301和302响应都不会被缓存除非增加一个额外的头选项，如Expires或者Cache-Control来指定它缓存。<meat />元素的刷新标签和JavaScript也可以实现URL的跳转，但是如果你必须要跳转的时候，最好的方法就是使用标准的3XXHTTP状态代码，这主要是为了确保“后退”按钮可以正确地使用。</p>
<p>但是要记住跳转会降低用户体验。在用户和HTML文档中间增加一个跳转，会拖延页面中所有元素的显示，因为在HTML文件被加载前任何文件（图像、Flash等）都不会被下载。</p>
<p>有一种经常被网页开发者忽略却往往十分浪费响应时间的跳转现象。这种现象发生在当URL本该有斜杠（/）却被忽略掉时。例如，当我们要访问http://astrology.yahoo.com/astrology 时，实际上返回的是一个包含301代码的跳转，它指向的是http://astrology.yahoo.com/astrology/  （注意末尾的斜杠）。在Apache服务器中可以使用Alias 或者 mod_rewrite或者the DirectorySlash来避免。</p>
<p>连接新网站和旧网站是跳转功能经常被用到的另一种情况。这种情况下往往要连接网站的不同内容然后根据用户的不同类型（如浏览器类型、用户账号所属类型）来进行跳转。使用跳转来实现两个网站的切换十分简单，需要的代码量也不多。尽管使用这种方法对于开发者来说可以降低复杂程度，但是它同样降低用户体验。一个可替代方法就是如果两者在同一台服务器上时使用Alias和mod_rewrite和实现。如果是因为域名的不同而采用跳转，那么可以通过使用Alias或者mod_rewirte建立CNAME（保存一个域名和另外一个域名之间关系的DNS记录）来替代。</p>
<h2 id="15、去除重复的JS文件">15、去除重复的JS文件</h2><p>在同一个页面中重复引用JavaScript文件会影响页面的性能。你可能会认为这种情况并不多见。对于美国前10大网站的调查显示其中有两家存在重复引用脚本的情况。有两种主要因素导致一个脚本被重复引用的奇怪现象发生：团队规模和脚本数量。如果真的存在这种情况，重复脚本会引起不必要的HTTP请求和无用的JavaScript运算，这降低了网站性能。</p>
<p>在Internet Explorer中会产生不必要的HTTP请求，而在Firefox却不会。在Internet Explorer中，如果一个脚本被引用两次而且它又不可缓存，它就会在页面加载过程中产生两次HTTP请求。即时脚本可以缓存，当用户重载页面时也会产生额外的HTTP请求。 </p>
<p>除增加额外的HTTP请求外，多次运算脚本也会浪费时间。在Internet Explorer和Firefox中不管脚本是否可缓存，它们都存在重复运算JavaScript的问题。<br>一个避免偶尔发生的两次引用同一脚本的方法是在模板中使用脚本管理模块引用脚本。在HTML页面中使用<script />标签引用脚本的最常见方法就是： </p>
<p><script type="text/javascript" src="menu_1.0.17.js"></script><br>在PHP中可以通过创建名为insertScript的方法来替代： </p>
<p>&lt;?php insertScript(“menu.js”) ?&gt;<br>为了防止多次重复引用脚本，这个方法中还应该使用其它机制来处理脚本，如检查所属目录和为脚本文件名中增加版本号以用于Expire文件头等。</p>
<h2 id="16、优化CSS_Spirite图片和其他图片">16、优化CSS Spirite图片和其他图片</h2><p>在Spirite中水平排列你的图片，垂直排列会稍稍增加文件大小；</p>
<p>Spirite中把颜色较近的组合在一起可以降低颜色数，理想状况是低于256色以便适用PNG8格式；</p>
<p>便于移动，不要在Spirite的图像中间留有较大空隙。这虽然不大会增加文件大小但对于用户代理来说它需要更少的内存来把图片解压为像素地图。100x100的图片为1万像素，而1000x1000就是100万像素。</p>
<p>对于 PNG 图片，考虑用 Pngcrush 或类似的工具进行优化。常见的工具如下:</p>
<p>pngcrush http://pmt.sourceforge.net/pngcrush/</p>
<p>pngrewrite http://www.pobox.com/~jason1/pngrewrite/</p>
<p>OptiPNG http://www.cs.toronto.edu/~cosmin/pngtech/optipng/ (refer: 教程)</p>
<p>PNGOut http://advsys.net/ken/utils.htm</p>
<p>另请参见: Five Tips For the Effective Use of PNG Images</p>
<p>对 JPEG 图片的优化工具：</p>
<p>jpegtran (http://jpegclub.org/</p>
<h2 id="17、根据实际项目情况，缓存可缓存的Ajax请求">17、根据实际项目情况，缓存可缓存的Ajax请求</h2><p>Ajax经常被提及的一个好处就是由于其从后台服务器传输信息的异步性而为用户带来的反馈的即时性。但是，使用Ajax并不能保证用户不会在等待异步的JavaScript和XML响应上花费时间。在很多应用中，用户是否需要等待响应取决于Ajax如何来使用。例如，在一个基于Web的Email客户端中，用户必须等待Ajax返回符合他们条件的邮件查询结果。记住一点，“异步”并不异味着“即时”，这很重要。</p>
<p>为了提高性能，优化Ajax响应是很重要的。提高Ajxa性能的措施中最重要的方法就是使响应具有可缓存性，具体的讨论可以查看Add an Expires or a Cache-Control Header。其它的几条规则也同样适用于Ajax：<br>Gizp压缩文件<br>减少DNS查找次数<br>精简JavaScript<br>避免跳转<br>配置ETags</p>
<p>让我们来看一个例子：一个Web20的Email客户端会使用Ajax来自动完成对用户地址薄的下载。如果用户在上次使用过Email web应用程序后没有对地址薄作任何的修改，而且Ajax响应通过Expire或者Cacke-Control头来实现缓存，那么就可以直接从上一次的缓存中读取地址薄了。必须告知浏览器是使用缓存中的地址薄还是发送一个新的请求。这可以通过为读取地址薄的Ajax URL增加一个含有上次编辑时间的时间戳来实现，例如，&amp;t=11900241612等。如果地址薄在上次下载后没有被编辑过，时间戳就不变，则从浏览器的缓存中加载从而减少了一次HTTP请求过程。如果用户修改过地址薄，时间戳就会用来确定新的URL和缓存响应并不匹配，浏览器就会重要请求更新地址薄。<br>即使你的Ajxa响应是动态生成的，哪怕它只适用于一个用户，那么它也应该被缓存起来。这样做可以使你的Web2.0应用程序更加快捷。</p>
<h2 id="18、在服务器端为请求文件头信息设置长久的Expires和Cache-Control，长久缓存文件">18、在服务器端为请求文件头信息设置长久的Expires和Cache-Control，长久缓存文件</h2><p>这条守则包括两方面的内容：</p>
<p>对于静态内容：设置文件头过期时间Expires的值为“Never expire”（永不过期）<br>对于动态内容：使用恰当的Cache-Control文件头来帮助浏览器进行有条件的请求网页内容设计现在越来越丰富，这就意味着页面中要包含更多的脚本、样式表、图片和Flash。第一次访问你页面的用户就意味着进行多次的HTTP请求，但是通过使用Expires文件头就可以使这样内容具有缓存性。它避免了接下来的页面访问中不必要的HTTP请求。Expires文件头经常用于图像文件，但是应该在所有的内容都使用他，包括脚本、样式表和Flash等。</p>
<p>浏览器（和代理）使用缓存来减少HTTP请求的大小和次数以加快页面访问速度。Web服务器在HTTP响应中使用Expires文件头来告诉客户端内容需要缓存多长时间。下面这个例子是一个较长时间的Expires文件头，它告诉浏览器这个响应直到2010年4月15日才过期。</p>
<p>Expires: Thu, 15 Apr 2010 20:00:00 GMT </p>
<p>如果你使用的是Apache服务器，可以使用ExpiresDefault来设定相对当前日期的过期时间。下面这个例子是使用ExpiresDefault来设定请求时间后10年过期的文件头：</p>
<p>ExpiresDefault “access plus 10 years” </p>
<p>要切记，如果使用了Expires文件头，当页面内容改变时就必须改变内容的文件名。依Yahoo!来说我们经常使用这样的步骤：在内容的文件名中加上版本号，如yahoo_2.0.6.js。 </p>
<p>使用Expires文件头只有会在用户已经访问过你的网站后才会起作用。当用户首次访问你的网站时这对减少HTTP请求次数来说是无效的，因为浏览器的缓存是空的。因此这种方法对于你网站性能的改进情况要依据他们“预缓存”存在时对你页面的点击频率（“预缓存”中已经包含了页面中的所有内容）。Yahoo!建立了一套测量方法，我们发现所有的页面浏览量中有75~85%都有“预缓存”。通过使用Expires文件头，增加了缓存在浏览器中内容的数量，并且可以在用户接下来的请求中再次使用这些内容，这甚至都不需要通过用户发送一个字节的请求。</p>
<h2 id="19、服务器端为请求文件设置Etag信息，长久缓存文件">19、服务器端为请求文件设置Etag信息，长久缓存文件</h2><p>Entity tags（ETags）（实体标签）是web服务器和浏览器用于判断浏览器缓存中的内容和服务器中的原始内容是否匹配的一种机制（“实体”就是所说的“内容”，包括图片、脚本、样式表等）。增加ETag为实体的验证提供了一个比使用“last-modified date（上次编辑时间）”更加灵活的机制。Etag是一个识别内容版本号的唯一字符串。唯一的格式限制就是它必须包含在双引号内。原始服务器通过含有ETag文件头的响应指定页面内容的ETag。 </p>
<p>HTTP/1.1 200 OK<br>Last-Modified: Tue, 12 Dec 2006 03:03:59 GMT<br>ETag: “10c24bc-4ab-457e1c1f”<br>Content-Length: 12195<br>稍后，如果浏览器要验证一个文件，它会使用If-None-Match文件头来把ETag传回给原始服务器。在这个例子中，如果ETag匹配，就会返回一个304状态码，这就节省了12195字节的响应。      GET /i/yahoo.gif HTTP/1.1 </p>
<p>Host: us.yimg.com<br>If-Modified-Since: Tue, 12 Dec 2006 03:03:59 GMT<br>If-None-Match: “10c24bc-4ab-457e1c1f”<br>HTTP/1.1 304 Not Modified </p>
<p>ETag的问题在于，它是根据可以辨别网站所在的服务器的具有唯一性的属性来生成的。当浏览器从一台服务器上获得页面内容后到另外一台服务器上进行验证时ETag就会不匹配，这种情况对于使用服务器组和处理请求的网站来说是非常常见的。默认情况下，Apache和IIS都会把数据嵌入ETag中，这会显著减少多服务器间的文件验证冲突。</p>
<p>Apache 1.3和2.x中的ETag格式为inode-size-timestamp。即使某个文件在不同的服务器上会处于相同的目录下，文件大小、权限、时间戳等都完全相同，但是在不同服务器上他们的内码也是不同的。 </p>
<p>IIS 5.0和IIS 6.0处理ETag的机制相似。IIS中的ETag格式为Filetimestamp:ChangeNumber。用ChangeNumber来跟踪IIS配置的改变。网站所用的不同IIS服务器间ChangeNumber也不相同。 不同的服务器上的Apache和IIS即使对于完全相同的内容产生的ETag在也不相同，用户并不会接收到一个小而快的304响应；相反他们会接收一个正常的200响应并下载全部内容。如果你的网站只放在一台服务器上，就不会存在这个问题。但是如果你的网站是架设在多个服务器上，并且使用Apache和IIS产生默认的ETag配置，你的用户获得页面就会相对慢一点，服务器会传输更多的内容，占用更多的带宽，代理也不会有效地缓存你的网站内容。即使你的内容拥有Expires文件头，无论用户什么时候点击“刷新”或者“重载”按钮都会发送相应的GET请求。 </p>
<p>如果你没有使用ETag提供的灵活的验证模式，那么干脆把所有的ETag都去掉会更好。Last-Modified文件头验证是基于内容的时间戳的。去掉ETag文件头会减少响应和下次请求中文件的大小。微软的这篇支持文稿讲述了如何去掉ETag。在Apache中，只需要在配置文件中简单添加下面一行代码就可以了：</p>
<p>FileETag none</p>
<h2 id="20、优雅退化，使用长链接">20、优雅退化，使用长链接</h2><h2 id="21、懒加载(lazyload)页面HTML和文件">21、懒加载(lazyload)页面HTML和文件</h2><p>你可以仔细看一下你的网页，问问自己“哪些内容是页面呈现时所必需首先加载的？哪些内容和结构可以稍后再加载？<br>把整个过程按照onload事件分隔成两部分，JavaScript是一个理想的选择。例如，如果你有用于实现拖放和动画的JavaScript，那么它就以等待稍后加载，因为页面上的拖放元素是在初始化呈现之后才发生的。其它的例如隐藏部分的内容（用户操作之后才显现的内容）和处于折叠部分的图像也可以推迟加载<br>工具可以节省你的工作量：YUI Image Loader可以帮你推迟加载折叠部分的图片，YUI Get utility是包含JS和 CSS的便捷方法。比如你可以打开Firebug的Net选项卡看一下Yahoo的首页。<br>当性能目标和其它网站开发实践一致时就会相得益彰。这种情况下，通过程序提高网站性能的方法告诉我们，在支持JavaScript的情况下，可以先去除用户体验，不过这要保证你的网站在没有JavaScript也可以正常运行。在确定页面运行正常后，再加载脚本来实现如拖放和动画等更加花哨的效果。</p>
<h2 id="22、预加载内容">22、预加载内容</h2><p>预加载和后加载看起来似乎恰恰相反，但实际上预加载是为了实现另外一种目标。预加载是在浏览器空闲时请求将来可能会用到的页面内容（如图像、样式表和脚本）。使用这种方法，当用户要访问下一个页面时，页面中的内容大部分已经加载到缓存中了，因此可以大大改善访问速度。</p>
<p>下面提供了几种预加载方法：<br>无条件加载：触发onload事件时，直接加载额外的页面内容。以Google.com为例，你可以看一下它的spirit image图像是怎样在onload中加载的。这个spirit image图像在google.com主页中是不需要的，但是却可以在搜索结果页面中用到它。<br>有条件加载：根据用户的操作来有根据地判断用户下面可能去往的页面并相应的预加载页面内容。在search.yahoo.com中你可以看到如何在你输入内容时加载额外的页面内容。<br>有预期的加载：载入重新设计过的页面时使用预加载。这种情况经常出现在页面经过重新设计后用户抱怨“新的页面看起来很酷，但是却比以前慢”。问题可能出在用户对于你的旧站点建立了完整的缓存，而对于新站点却没有任何缓存内容。因此你可以在访问新站之前就加载一部内容来避免这种结果的出现。在你的旧站中利用浏览器的空余时间加载新站中用到的图像的和脚本来提高访问速度。</p>
<h2 id="23、精简DOM的数量">23、精简DOM的数量</h2><p>一个复杂的页面意味着需要下载更多数据，同时也意味着JavaScript遍历DOM的效率越慢。比如当你增加一个事件句柄时在500和5000个DOM元素中循环效果肯定是不一样的。<br>大量的DOM元素的存在意味着页面中有可以不用移除内容只需要替换元素标签就可以精简的部分。你在页面布局中使用表格了吗？你有没有仅仅为了布局而引入更多的<div>元素呢？也许会存在一个适合或者在语意是更贴切的标签可以供你使用。<br>YUI CSS utilities可以给你的布局带来巨大帮助：grids.css可以帮你实现整体布局，font.css和reset.css可以帮助你移除浏览器默认格式。它提供了一个重新审视你页面中标签的机会，比如只有在语意上有意义时才使用<div>，而不是因为它具有换行效果才使用它。<br>DOM元素数量很容易计算出来，只需要在Firebug的控制台内输入：<br>document.getElementsByTagName(‘*’).length<br>那么多少个DOM元素算是多呢？这可以对照有很好标记使用的类似页面。比如Yahoo!主页是一个内容非常多的页面，但是它只使用了700个元素（HTML标签）。</div></div></p>
<h2 id="24、避免404错误">24、避免404错误</h2><p>HTTP请求时间消耗是很大的，因此使用HTTP请求来获得一个没有用处的响应（例如404没有找到页面）是完全没有必要的，它只会降低用户体验而不会有一点好处。 </p>
<p>有些站点把404错误响应页面改为“你是不是要找<em>*</em>”，这虽然改进了用户体验但是同样也会浪费服务器资源（如数据库等）。最糟糕的情况是指向外部JavaScript的链接出现问题并返回404代码。首先，这种加载会破坏并行加载；其次浏览器会把试图在返回的404响应内容中找到可能有用的部分当作JavaScript代码来执行。</p>
<h2 id="25、尽量用GET请求代替POST请求">25、尽量用GET请求代替POST请求</h2><p>当使用XMLHttpRequest时，浏览器中的POST方法是一个“两步走”的过程：首先发送文件头，然后才发送数据。因此使用GET最为恰当，因为它只需发送一个TCP包（除非你有很多cookie）。IE中URL的最大长度为2K，因此如果你要发送一个超过2K的数据时就不能使用GET了。 </p>
<p>一个有趣的不同就是POST并不像GET那样实际发送数据。根据HTTP规范，GET意味着“获取”数据，因此当你仅仅获取数据时使用GET更加有意义（从语意上讲也是如此），相反，发送并在服务端保存数据时使用POST。</p>
<h2 id="26、优化JS性能，尽量使用事件委托">26、优化JS性能，尽量使用事件委托</h2><p>给多个DOM绑定事件时，尽量使用事件委托</p>
<p>想象一下，如果你有一个无序列表，里面有一堆<li>元素，每一个</li><li>元素都会在点击的时候触发一个行为。这个时候，你通常会在每一个元素上添加一个事件监听，但是如果当这个元素或者你添加了监听的这个对象会被频繁的移除添加呢？这个时候，你在移除添加元素的同时需要处理事件监听的移除和添加。这个时候，我们就需要引入事件委托了。 </li></p>
<p>事件委托是在父级元素上添加一个事件监听，来替代在每一个子元素上添加事件监听。当事件被触发时，event.target会评估相应的措施是否需要被执行。下面我们给出了一个简单的例子： </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取元素，添加事件监听  </span></span><br><span class="line"><span class="built_in">document</span>.querySelector(<span class="string">'#parent-list'</span>).addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;  </span><br><span class="line">    <span class="comment">// e.target 是一个被点击的元素!  </span></span><br><span class="line">    <span class="comment">// 如果它是一个列表元素  </span></span><br><span class="line">    <span class="keyword">if</span>(e.target &amp;&amp; e.target.tagName == <span class="string">'LI'</span>) &#123;  </span><br><span class="line">        <span class="comment">// 我们找到了这个元素，对他的操作可以写在这里。  </span></span><br><span class="line">    &#125;  </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>上面的例子是不可思议的简单，当事件发生的时候，它没有轮询父节点去寻找匹配的元素或选择器，且它不支持基于选择器的查询（例如用class name，或者id来查询）。所有的JavaScript框架提供了委托选择器匹配。重点是，你避免了为每一个元素加载事件监听，而是在父元素上加一个事件监听。这样大大的增加了效率，并且减少了很多维护！</p>
<h2 id="27、减少Cookie体积">27、减少Cookie体积</h2><p>HTTP coockie可以用于权限验证和个性化身份等多种用途。coockie内的有关信息是通过HTTP文件头来在web服务器和浏览器之间进行交流的。因此保持coockie尽可能的小以减少用户的响应时间十分重要。</p>
<p>有关更多信息可以查看Tenni Theurer和Patty Chi的文章“When the Cookie Crumbles”。这们研究中主要包括：</p>
<p>去除不必要的coockie </p>
<p>使coockie体积尽量小以减少对用户响应的影响 </p>
<p>注意在适应级别的域名上设置coockie以便使子域名不受影响 </p>
<p>设置合理的过期时间。较早地Expire时间和不要过早去清除coockie，都会改善用户的响应时间。</p>
<h2 id="28、不要在HTML中缩放图像">28、不要在HTML中缩放图像</h2><p>不要为了在HTML中设置长宽而使用比实际需要大的图片。如果你需要： </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img width=<span class="string">"100"</span> height=<span class="string">"100"</span> src=<span class="string">"mycat.jpg"</span> alt=<span class="string">"My Cat"</span> /&gt;</span><br></pre></td></tr></table></figure>
<p>那么你的图片（mycat.jpg）就应该是100x100像素而不是把一个500x500像素的图片缩小使用。</p>
<h2 id="29、减少favicon-ico的容量，设置成可缓存">29、减少favicon.ico的容量，设置成可缓存</h2><p>favicon.ico是位于服务器根目录下的一个图片文件。它是必定存在的，因为即使你不关心它是否有用，浏览器也会对它发出请求，因此最好不要返回一个404 Not Found的响应。由于是在同一台服务器上，它每被请求一次coockie就会被发送一次。这个图片文件还会影响下载顺序，例如在IE中当你在onload中请求额外的文件时，favicon会在这些额外内容被加载前下载。 </p>
<p>因此，为了减少favicon.ico带来的弊端，要做到：</p>
<p>文件尽量地小，最好小于1K<br>在适当的时候（也就是你不要打算再换favicon.ico的时候，因为更换新文件时不能对它进行重命名）为它设置Expires文件头。你可以很安全地把Expires文件头设置为未来的几个月。你可以通过核对当前favicon.ico的上次编辑时间来作出判断。 </p>
<p>Imagemagick可以帮你创建小巧的favicon。</p>
<h2 id="30、移动端网站保持单个文件小于25K">30、移动端网站保持单个文件小于25K</h2><p>这条限制主要是因为iPhone不能缓存大于25K的文件。注意这里指的是解压缩后的大小。由于单纯gizp压缩可能达不要求，因此精简文件就显得十分重要。 </p>
<p>查看更多信息，请参阅Wayne Shea和Tenni Theurer的文件“Performance Research, Part 5: iPhone Cacheability - Making it Stick”。</p>
<h2 id="31、避免用table布局，使用div结合CSS达到布局的效果">31、避免用table布局，使用div结合CSS达到布局的效果</h2><p>使用table布局，IE浏览器会等待table内的HTML加载完成后在渲染，展示给用户的时间会有一段空白。</p>
<p>用div布局会边加载dom边渲染，提升浏览器渲染页面的速度。</p>
<h2 id="32、最占响应时间的是客户端组件的请求响应速度，建议将组件从不同域名下载，可达到并发的目的；">32、最占响应时间的是客户端组件的请求响应速度，建议将组件从不同域名下载，可达到并发的目的；</h2><p>HTTP1.1协议建议允许并发下载，IE8支持6个并发请求；但是DNS有查询损耗，域名不要超过2-4个</p>
<h2 id="33、页面静态化">33、页面静态化</h2><p>让后端输出静态HTML到服务器，并缓存。这样可以大量减少后端对页面进行大量运算和请求等待的时间。</p>
<h2 id="34、使用媒体查询加载指定大小的背景图片">34、使用媒体查询加载指定大小的背景图片</h2><p>直到CSS @supports被广泛支持，CSS媒体查询的使用接近于CSS中写逻辑控制。我们经常用CSS媒体查询来根据设备调整CSS属性（通常根据屏幕宽度调整CSS属性），例如根据不同的屏幕宽度来设置不同的元素宽度或者是悬浮位置。那么我们为什么不用这种方式来改变背景图片呢？ </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 默认是为桌面应用加载图片 */</span>  </span><br><span class="line">.someElement &#123; background-image: url(sunset.jpg); &#125;  </span><br><span class="line">   </span><br><span class="line">@media only screen and (max-width : <span class="number">1024</span>px) &#123;  </span><br><span class="line">    .someElement &#123; background-image: url(sunset-small.jpg); &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面的代码片段是为手机设备或是类似的移动设备加载一个较小尺寸的图片，特别是需要一个特别小的图片时（例如图片的大小几乎不可视）。</p>
<h2 id="35、减少DNS查找次数">35、减少DNS查找次数</h2><p>域名系统（DNS）提供了域名和IP的对应关系，就像电话本中人名和他们的电话号码的关系一样。当你在浏览器地址栏中输入www.dudo.org时，DNS解析服务器就会返回这个域名对应的IP地址。DNS解析的过程同样也是需要时间的。一般情况下返回给定域名对应的IP地址会花费20到120毫秒的时间。而且在这个过程中浏览器什么都不会做直到DNS查找完毕。</p>
<p>缓存DNS查找可以改善页面性能。这种缓存需要一个特定的缓存服务器，这种服务器一般属于用户的ISP提供商或者本地局域网控制，但是它同样会在用户使用的计算机上产生缓存。DNS信息会保留在操作系统的DNS缓存中（微软Windows系统中DNS Client Service）。大多数浏览器有独立于操作系统以外的自己的缓存。由于浏览器有自己的缓存记录，因此在一次请求中它不会受到操作系统的影响。</p>
<p>Internet Explorer默认情况下对DNS查找记录的缓存时间为30分钟，它在注册表中的键值为DnsCacheTimeout。Firefox对DNS的查找记录缓存时间为1分钟，它在配置文件中的选项为network.dnsCacheExpiration（Fasterfox把这个选项改为了1小时）。</p>
<p>当客户端中的DNS缓存都为空时（浏览器和操作系统都为空），DNS查找的次数和页面中主机名的数量相同。这其中包括页面中URL、图片、脚本文件、样式表、Flash对象等包含的主机名。减少主机名的数量可以减少DNS查找次数。</p>
<p>减少主机名的数量还可以减少页面中并行下载的数量。减少DNS查找次数可以节省响应时间，但是减少并行下载却会增加响应时间。我的指导原则是把这些页面中的内容分割成至少两部分但不超过四部分。这种结果就是在减少DNS查找次数和保持较高程度并行下载两者之间的权衡了。</p>
<h2 id="36、尽早刷新输出缓冲">36、尽早刷新输出缓冲</h2><p>当用户请求一个页面时，无论如何都会花费200到500毫秒用于后台组织HTML文件。在这期间，浏览器会一直空闲等待数据返回。在PHP中，你可以使用flush()方法，它允许你把已经编译的好的部分HTML响应文件先发送给浏览器，这时浏览器就会可以下载文件中的内容（脚本等）而后台同时处理剩余的HTML页面。这样做的效果会在后台烦恼或者前台较空闲时更加明显。 </p>
<p>输出缓冲应用最好的一个地方就是紧跟在<head>之后，因为HTML的头部分容易生成而且头部往往包含CSS和JavaScript文件，这样浏览器就可以在后台编译剩余HTML的同时并行下载它们。 例子：</head></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">... &lt;!-- css, js --&gt; </span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="title">head</span>&gt;</span> </span><br><span class="line"><span class="php"><span class="preprocessor">&lt;?php</span> flush(); <span class="preprocessor">?&gt;</span></span> </span><br><span class="line"><span class="tag">&lt;<span class="title">body</span>&gt;</span> </span><br><span class="line">... <span class="comment">&lt;!-- content --&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>为了证明使用这项技术的好处，Yahoo!搜索率先研究并完成了用户测试。</p>
<h2 id="37、减少DOM访问">37、减少DOM访问</h2><p>使用JavaScript访问DOM元素比较慢，因此为了获得更多的应该页面，应该做到：</p>
<p>缓存已经访问过的有关元素 </p>
<p>线下更新完节点之后再将它们添加到文档树中 </p>
<p>避免使用JavaScript来修改页面布局 </p>
<p>有关此方面的更多信息请查看Julien Lecomte在YUI专题中的文章“高性能Ajax应该程序”。</p>
<h2 id="38、打包组件成复合文本">38、打包组件成复合文本</h2><p>把页面内容打包成复合文本就如同带有多附件的Email，它能够使你在一个HTTP请求中取得多个组件（切记：HTTP请求是很奢侈的）。当你使用这条规则时，首先要确定用户代理是否支持（iPhone就不支持）。</p>

      </div>
      <footer class="article-footer">
        <a data-url="http://blog.css6.com/2015/05/21/网站前端性能优化/" data-id="cifp0o9of000catrly1n27i8p" class="article-share-link"><i class="fa fa-share"></i>分享到</a>
        
        
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/前端/">前端</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/性能优化/">性能优化</a></li></ul>

      </footer>
    </div>
    <div class="bdsharebuttonbox"><a href="#" class="bds_more" data-cmd="more"></a><a href="#" class="bds_qzone" data-cmd="qzone"></a><a href="#" class="bds_tsina" data-cmd="tsina"></a><a href="#" class="bds_tqq" data-cmd="tqq"></a><a href="#" class="bds_renren" data-cmd="renren"></a><a href="#" class="bds_weixin" data-cmd="weixin"></a></div>
<script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdPic":"","bdStyle":"0","bdSize":"16"},"share":{},"image":{"viewList":["qzone","tsina","tqq","renren","weixin"],"viewText":"分享到：","viewSize":"16"},"selectShare":{"bdContainerClass":null,"bdSelectMiniList":["qzone","tsina","tqq","renren","weixin"]}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>
  </article>
  
  
  <section id="comments">
    <!-- 多说评论框 start -->
    <div class="ds-thread" data-thread-key="post-网站前端性能优化" data-title="网站前端性能优化指南" data-url="http://blog.css6.com/2015/05/21/网站前端性能优化/"></div>
    <!-- 多说评论框 end -->
    <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
    <script type="text/javascript">
    var duoshuoQuery = {short_name:'css3'};
      (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = true;
        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0]
         || document.getElementsByTagName('body')[0]).appendChild(ds);
      })();
      </script>
    <!-- 多说公共JS代码 end -->
  </section>
  

            </div>
          </section>
          <aside id="sidebar">
  <a class="sidebar-toggle" title="Expand Sidebar"><i class="toggle icon"></i></a>
  <div class="sidebar-top">
    <p>关注我 :</p>
    <ul class="social-links">
      
        <li><a class="social-tooltip" title="github" href="https://github.com/jsonxu" target="_blank"><i class="icon fa fa-github"></i></a></li>
      
        <li><a class="social-tooltip" title="weibo" href="http://weibo.com/kaixu" target="_blank"><i class="icon fa fa-weibo"></i></a></li>
      
    </ul>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2015/07/06/面试题解析-找出数组中重复项/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">下一篇</strong>
      <p class="article-nav-title">
        
          面试题解析:找出数组中重复项
        
      </p>
      <i class="icon fa fa-chevron-right" id="icon-chevron-right"></i>
    </a>
  
  
    <a href="/2015/04/28/-Mac-OS-X-10-10-3-Yosemite下面解决XAMPP无法开启mysql的问题/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">上一篇</strong>
      <p class="article-nav-title">Mac OS X 10.10.3 Yosemite下面解决XAMPP无法开启mysql的问题</p>
      <i class="icon fa fa-chevron-left" id="icon-chevron-left"></i>
    </a>
  
</nav>

  
  <div class="widgets-container">
    
      
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul id="recent-post" class="">
        
          <li>
            
            <div class="item-thumbnail">
              
<a href="/2015/10/13/江苏省昆山市关于物业费和停车费收取的法规条文/" class="thumbnail">
  
    <span style="background-image:url(http://css6cdn.oss-cn-hangzhou.aliyuncs.com/m%2F201510%2Fjijia.png
)" alt="江苏省昆山市关于物业费和停车费收取的法规条文" class="thumbnail-image"></span>
  
</a>

            </div>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="/categories/吐槽/">吐槽</a></p>
              <p class="item-title"><a href="/2015/10/13/江苏省昆山市关于物业费和停车费收取的法规条文/" class="title">江苏省昆山市关于物业费和停车费收取的法规条文</a></p>
              <p class="item-date"><time datetime="2015-10-13T06:50:59.000Z" itemprop="datePublished">2015-10-13</time></p>
            </div>
          </li>
        
          <li>
            
            <div class="item-thumbnail">
              
<a href="/2015/10/10/JS前端数据加密方案/" class="thumbnail">
  
    <span style="background-image:url(http://cdn.css6.com/m%2F201510%2F095IA458-0.jpg
)" alt="JS前端数据加密方案" class="thumbnail-image"></span>
  
</a>

            </div>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="/categories/前端笔记/">前端笔记</a></p>
              <p class="item-title"><a href="/2015/10/10/JS前端数据加密方案/" class="title">JS前端数据加密方案</a></p>
              <p class="item-date"><time datetime="2015-10-10T06:03:54.000Z" itemprop="datePublished">2015-10-10</time></p>
            </div>
          </li>
        
          <li>
            
            <div class="item-thumbnail">
              
<a href="/2015/09/17/升级IOS9-吐槽/" class="thumbnail">
  
    <span style="background-image:url(http://cdn.css6.com/m/201509/ios9.jpg
)" alt="升级IOS9,吐槽" class="thumbnail-image"></span>
  
</a>

            </div>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="/categories/吐槽/">吐槽</a></p>
              <p class="item-title"><a href="/2015/09/17/升级IOS9-吐槽/" class="title">升级IOS9,吐槽</a></p>
              <p class="item-date"><time datetime="2015-09-17T14:15:22.000Z" itemprop="datePublished">2015-09-17</time></p>
            </div>
          </li>
        
          <li>
            
            <div class="item-thumbnail">
              
<a href="/2015/09/14/react学习路径参考/" class="thumbnail">
  
    <span style="background-image:url(http://cdn.css6.com/m/201509/sh.jpg
)" alt="react学习路径参考" class="thumbnail-image"></span>
  
</a>

            </div>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="/categories/技术文摘/">技术文摘</a></p>
              <p class="item-title"><a href="/2015/09/14/react学习路径参考/" class="title">react学习路径参考</a></p>
              <p class="item-date"><time datetime="2015-09-14T07:27:19.000Z" itemprop="datePublished">2015-09-14</time></p>
            </div>
          </li>
        
          <li>
            
            <div class="item-thumbnail">
              
<a href="/2015/07/06/面试题解析-找出数组中重复项/" class="thumbnail">
  
    <span class="thumbnail-image thumbnail-none"></span>
  
</a>

            </div>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="/categories/前端笔记/">前端笔记</a></p>
              <p class="item-title"><a href="/2015/07/06/面试题解析-找出数组中重复项/" class="title">面试题解析:找出数组中重复项</a></p>
              <p class="item-date"><time datetime="2015-07-06T02:47:40.000Z" itemprop="datePublished">2015-07-06</time></p>
            </div>
          </li>
        
      </ul>
    </div>
  </div>

    
      
  <div class="widget-wrap widget-list">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/前端笔记/">前端笔记</a><span class="category-list-count">15</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/吐槽/">吐槽</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/技术文摘/">技术文摘</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/生活随笔/">生活随笔</a><span class="category-list-count">3</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget-wrap widget-list">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">十月 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">九月 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/07/">七月 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/05/">五月 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/04/">四月 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/03/">三月 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/02/">二月 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/01/">一月 2015</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/12/">十二月 2014</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/11/">十一月 2014</a><span class="archive-list-count">9</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget-wrap widget-list">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/FIS/">FIS</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/FIS-pure/">FIS-pure</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Git/">Git</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Github/">Github</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/IE/">IE</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/IOS9/">IOS9</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/VIM/">VIM</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/XAMPP/">XAMPP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/contributions/">contributions</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/css6/">css6</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/github/">github</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/">hexo</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascript/">javascript</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/markdown/">markdown</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/meta/">meta</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/react/">react</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/react-native/">react native</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/个人介绍/">个人介绍</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/产品经理/">产品经理</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/京东-1号店-不约/">京东 1号店 不约</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/前端/">前端</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/前端工程化/">前端工程化</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/前端架构/">前端架构</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/加密/">加密</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/博客/">博客</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/命令/">命令</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/命令行/">命令行</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/性能优化/">性能优化</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/技术文摘/">技术文摘</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/指南/">指南</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/教程/">教程</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数组/">数组</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/架构师/">架构师</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/浏览器指纹/">浏览器指纹</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/用户信息采集/">用户信息采集</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/组件库/">组件库</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/规范/">规范</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/面试题/">面试题</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget-wrap widget-float">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/FIS/" style="font-size: 10px;">FIS</a> <a href="/tags/FIS-pure/" style="font-size: 10px;">FIS-pure</a> <a href="/tags/Git/" style="font-size: 10px;">Git</a> <a href="/tags/Github/" style="font-size: 10px;">Github</a> <a href="/tags/IE/" style="font-size: 10px;">IE</a> <a href="/tags/IOS9/" style="font-size: 10px;">IOS9</a> <a href="/tags/VIM/" style="font-size: 10px;">VIM</a> <a href="/tags/XAMPP/" style="font-size: 10px;">XAMPP</a> <a href="/tags/contributions/" style="font-size: 10px;">contributions</a> <a href="/tags/css6/" style="font-size: 10px;">css6</a> <a href="/tags/github/" style="font-size: 10px;">github</a> <a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/javascript/" style="font-size: 15px;">javascript</a> <a href="/tags/markdown/" style="font-size: 10px;">markdown</a> <a href="/tags/meta/" style="font-size: 10px;">meta</a> <a href="/tags/react/" style="font-size: 10px;">react</a> <a href="/tags/react-native/" style="font-size: 10px;">react native</a> <a href="/tags/个人介绍/" style="font-size: 10px;">个人介绍</a> <a href="/tags/产品经理/" style="font-size: 15px;">产品经理</a> <a href="/tags/京东-1号店-不约/" style="font-size: 15px;">京东 1号店 不约</a> <a href="/tags/前端/" style="font-size: 10px;">前端</a> <a href="/tags/前端工程化/" style="font-size: 10px;">前端工程化</a> <a href="/tags/前端架构/" style="font-size: 10px;">前端架构</a> <a href="/tags/加密/" style="font-size: 10px;">加密</a> <a href="/tags/博客/" style="font-size: 15px;">博客</a> <a href="/tags/命令/" style="font-size: 10px;">命令</a> <a href="/tags/命令行/" style="font-size: 10px;">命令行</a> <a href="/tags/性能优化/" style="font-size: 10px;">性能优化</a> <a href="/tags/技术文摘/" style="font-size: 10px;">技术文摘</a> <a href="/tags/指南/" style="font-size: 10px;">指南</a> <a href="/tags/教程/" style="font-size: 20px;">教程</a> <a href="/tags/数组/" style="font-size: 10px;">数组</a> <a href="/tags/架构师/" style="font-size: 10px;">架构师</a> <a href="/tags/浏览器指纹/" style="font-size: 10px;">浏览器指纹</a> <a href="/tags/用户信息采集/" style="font-size: 10px;">用户信息采集</a> <a href="/tags/组件库/" style="font-size: 10px;">组件库</a> <a href="/tags/规范/" style="font-size: 10px;">规范</a> <a href="/tags/面试题/" style="font-size: 10px;">面试题</a>
    </div>
  </div>


    
      
  <div class="widget-wrap widget-list">
    <h3 class="widget-title">链接</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="http://www.pingan.com/">中国平安</a>
          </li>
        
      </ul>
    </div>
  </div>


    
  </div>
</aside>
        </div>
      </div>
    </div>
    <footer id="footer">
  
  <div class="container">
    <div class="container-inner">
      <a id="back-to-top" href="javascript:;"><i class="icon fa fa-angle-up"></i></a>
      <div class="credit">
        <p class="logo-wrap">
          <a href="/" class="logo"></a>
        </p>
        <p>&copy; 2015 json xu</p>
      </div>
    </div>
  </div>
</footer>
    


  <script src="http://cdn.css6.com/js/jquery-2.1.3.min.js"></script>



  <script src="http://cdn.css6.com/fancybox/jquery.fancybox.pack.js"></script>



  <script src="http://cdn.css6.com/scrollLoading/jquery.scrollLoading.js"></script>
  <script src="http://cdn.css6.com/scrollLoading/main.js"></script>

<script src="http://cdn.css6.com/js/html-patch.js"></script>
<script src="http://cdn.css6.com/js/script.js"></script>

  </div>
</body>
</html>
